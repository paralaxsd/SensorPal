<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="SensorPal.Mobile.Pages.SettingsPage"
             Title="Settings">

    <ScrollView>
        <VerticalStackLayout Padding="16" Spacing="24">

            <!-- Detection -->
            <Label Text="Detection" FontAttributes="Bold" FontSize="18" />

            <VerticalStackLayout Spacing="8">
                <HorizontalStackLayout Spacing="8">
                    <Label Text="Noise Threshold" VerticalOptions="Center" />
                    <Label x:Name="ThresholdLabel"
                           TextColor="OrangeRed"
                           VerticalOptions="Center" />
                </HorizontalStackLayout>
                <Slider x:Name="ThresholdSlider"
                        Minimum="-60" Maximum="0"
                        ValueChanged="OnThresholdChanged" />
                <Label Text="Lower value = more sensitive (picks up quieter sounds)"
                       TextColor="Gray" FontSize="12" />
            </VerticalStackLayout>

            <!-- Recording -->
            <Label Text="Recording" FontAttributes="Bold" FontSize="18" />

            <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto,Auto"
                  RowSpacing="20">

                <Label Grid.Row="0" Text="Pre-Roll (s)" VerticalOptions="Center" />
                <HorizontalStackLayout Grid.Row="0" Grid.Column="1" Spacing="4">
                    <Button Text="−" WidthRequest="44" HeightRequest="44"
                            Clicked="OnPreRollMinus" />
                    <Label x:Name="PreRollLabel" WidthRequest="32"
                           HorizontalTextAlignment="Center" VerticalOptions="Center"
                           FontSize="16" />
                    <Button Text="+" WidthRequest="44" HeightRequest="44"
                            Clicked="OnPreRollPlus" />
                </HorizontalStackLayout>

                <Label Grid.Row="1" Text="Post-Roll (s)" VerticalOptions="Center" />
                <HorizontalStackLayout Grid.Row="1" Grid.Column="1" Spacing="4">
                    <Button Text="−" WidthRequest="44" HeightRequest="44"
                            Clicked="OnPostRollMinus" />
                    <Label x:Name="PostRollLabel" WidthRequest="32"
                           HorizontalTextAlignment="Center" VerticalOptions="Center"
                           FontSize="16" />
                    <Button Text="+" WidthRequest="44" HeightRequest="44"
                            Clicked="OnPostRollPlus" />
                </HorizontalStackLayout>

                <Label Grid.Row="2" Text="Background Bitrate" VerticalOptions="Center" />
                <Picker Grid.Row="2" Grid.Column="1"
                        x:Name="BitratePicker"
                        WidthRequest="120"
                        HorizontalOptions="End" />

            </Grid>

            <!-- Notifications -->
            <Label Text="Notifications" FontAttributes="Bold" FontSize="18" />

            <Grid ColumnDefinitions="*,Auto">
                <Label Text="Enable Notifications" VerticalOptions="Center" />
                <Switch x:Name="NotificationsSwitch"
                        Grid.Column="1"
                        Toggled="OnNotificationsToggled" />
            </Grid>
            <Label x:Name="NotificationsHintLabel"
                   Text="Get notified when a noise event is detected."
                   TextColor="Gray" FontSize="12" />

            <!-- Security -->
            <Label Text="Security" FontAttributes="Bold" FontSize="18" />

            <VerticalStackLayout Spacing="8">
                <Label Text="Server URL" VerticalOptions="Center" />
                <Entry x:Name="ServerUrlEntry"
                       Keyboard="Url"
                       FontFamily="Courier New"
                       FontSize="12" />
                <Label Text="Leave blank to use the default URL from app settings."
                       TextColor="Gray" FontSize="12" />
            </VerticalStackLayout>

            <VerticalStackLayout Spacing="8">
                <Label Text="API Key" VerticalOptions="Center" />
                <Entry x:Name="ApiKeyEntry"
                       Placeholder="Paste key from server console"
                       FontFamily="Courier New"
                       FontSize="12" />
                <Label Text="Enter the API key shown in the server log on first launch."
                       TextColor="Gray" FontSize="12" />
            </VerticalStackLayout>

            <!-- Actions -->
            <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                <Button Text="Cancel"
                        BackgroundColor="Transparent"
                        TextColor="Gray"
                        Clicked="OnCancelClicked" />
                <Button Grid.Column="1"
                        x:Name="SaveButton"
                        Text="Save"
                        Clicked="OnSaveClicked" />
            </Grid>

            <Label Text="Changes take effect at the start of the next monitoring session."
                   TextColor="Gray" FontSize="12" HorizontalOptions="Center"
                   HorizontalTextAlignment="Center" />

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>
